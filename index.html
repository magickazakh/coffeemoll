<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ–Ω—é –ö–æ—Ñ–µ–π–Ω–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- –°–¢–ò–õ–ò --- */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; padding: 0; background-color: #f3f4f6; color: #1f2937; padding-bottom: 100px; -webkit-tap-highlight-color: transparent; }
        header { background-color: #ffffff; padding: 15px; position: sticky; top: 0; z-index: 50; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        h1 { margin: 0; font-size: 18px; font-weight: 800; color: #111; text-align: center; }
        
        /* –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ */
        .category-section { margin-bottom: 20px; }
        .category-title { padding: 15px 15px 5px 15px; font-size: 20px; font-weight: 800; color: #374151; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: white; border-radius: 16px; padding: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); display: flex; flex-direction: column; justify-content: space-between; transition: transform 0.1s; }
        .card:active { transform: scale(0.98); }
        .card-img-container { width: 100%; height: 100px; background: #f9fafb; border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 8px; overflow: hidden; }
        .card img { width: 60%; height: 60%; object-fit: contain; }
        .card h3 { margin: 0 0 5px 0; font-size: 14px; font-weight: 600; line-height: 1.3; }
        .card .desc { font-size: 11px; color: #6b7280; margin-bottom: 8px; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .price-row { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }
        .price { font-weight: 700; font-size: 15px; color: #111; }
        .add-btn { background-color: #FFD54F; color: #3e2723; border: none; border-radius: 8px; padding: 6px 12px; font-weight: 600; font-size: 12px; cursor: pointer; }

        /* –ú–û–î–ê–õ–ö–ò (–û–±—â–∏–µ —Å—Ç–∏–ª–∏) */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: flex-end; justify-content: center; }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: 20px 20px 0 0; padding: 20px; box-sizing: border-box; max-height: 90vh; overflow-y: auto; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .modal-title { font-size: 20px; font-weight: bold; }
        .close-icon { font-size: 24px; cursor: pointer; color: #888; }

        /* –≠–ª–µ–º–µ–Ω—Ç—ã —Ñ–æ—Ä–º */
        .option-group { margin-bottom: 20px; }
        .option-label { font-weight: 600; margin-bottom: 8px; display: block; font-size: 14px; color: #444; }
        
        /* –†–∞–¥–∏–æ –∏ –¢–∞–±—ã */
        .radio-group { display: flex; gap: 10px; flex-wrap: wrap; }
        .radio-label { flex: 1; text-align: center; padding: 10px; border: 1px solid #ddd; border-radius: 10px; cursor: pointer; font-size: 14px; transition: 0.2s; min-width: 80px; display: flex; align-items: center; justify-content: center; flex-direction: column;}
        .radio-input { display: none; }
        .radio-input:checked + .radio-label { background-color: #FFD54F; border-color: #FFD54F; color: #3e2723; font-weight: bold; }

        /* –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ */
        select, input[type="text"], input[type="number"], input[type="tel"], textarea { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; font-size: 16px; box-sizing: border-box; -webkit-appearance: none; background: #fff; margin-bottom: 10px; font-family: inherit; }
        textarea { resize: none; height: 80px; }

        /* –ß–µ–∫–±–æ–∫—Å—ã (Toggle) */
        .checkbox-row { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; border-top: 1px solid #eee; }
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #FFD54F; }
        input:checked + .slider:before { transform: translateX(24px); }

        /* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */
        .modal-footer { margin-top: 20px; display: flex; gap: 10px; }
        .modal-add-btn { background: #2ecc71; color: white; width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; }
        .main-btn { position: fixed; bottom: 15px; left: 15px; right: 15px; background: #2ecc71; color: white; padding: 16px; border-radius: 14px; text-align: center; font-size: 16px; font-weight: 700; box-shadow: 0 4px 12px rgba(46, 204, 113, 0.4); display: none; z-index: 900; }

        /* –°–µ–∫—Ü–∏—è –ò—Ç–æ–≥–æ –≤ —á–µ–∫–∞—É—Ç–µ */
        .checkout-total { font-size: 18px; font-weight: bold; margin-top: 10px; text-align: right; border-top: 1px solid #eee; padding-top: 10px; }
        .delivery-info { font-size: 13px; color: #2ecc71; margin-top: 5px; text-align: right; }
    </style>
</head>
<body>

<header>
    <h1 id="header-title">CoffeeMoll –ú–µ–Ω—é</h1>
</header>

<div id="app"></div>

<div class="main-btn" id="cart-btn" onclick="openCheckout()">
    –ö –∫–æ—Ä–∑–∏–Ω–µ
</div>

<div class="modal-overlay" id="product-modal" onclick="closeProductModal(event)">
    <div class="modal-content" id="product-modal-content"></div>
</div>

<div class="modal-overlay" id="checkout-modal">
    <div class="modal-content">
        <div class="modal-header">
            <div class="modal-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</div>
            <div class="close-icon" onclick="closeCheckout()">‚úï</div>
        </div>
        
        <div class="option-group">
            <label class="option-label">–í–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç—ã</label>
            <input type="text" id="client-name" placeholder="–í–∞—à–µ –∏–º—è">
            <input type="tel" id="client-phone" placeholder="–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (+7...)">
        </div>

        <div class="option-group">
            <label class="option-label">–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è</label>
            <div class="radio-group">
                <input type="radio" name="deliveryType" id="d-pickup" class="radio-input" value="pickup" checked onchange="toggleDelivery()">
                <label for="d-pickup" class="radio-label">üö∂ –°–∞–º–æ–≤—ã–≤–æ–∑</label>
                
                <input type="radio" name="deliveryType" id="d-delivery" class="radio-input" value="delivery" onchange="toggleDelivery()">
                <label for="d-delivery" class="radio-label">üöó –î–æ—Å—Ç–∞–≤–∫–∞<br><small>+600 ‚Ç∏</small></label>
            </div>
        </div>

        <div id="address-block" style="display: none;">
            <div class="option-group">
                <label class="option-label">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                <textarea id="delivery-address" placeholder="–£–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞, –ø–æ–¥—ä–µ–∑–¥..."></textarea>
            </div>
        </div>

        <div class="option-group">
            <label class="option-label">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</label>
            <div class="radio-group">
                <input type="radio" name="paymentType" id="p-cash" class="radio-input" value="–ù–∞–ª–∏—á–Ω—ã–º–∏" checked onchange="togglePayment()">
                <label for="p-cash" class="radio-label">üíµ –ù–∞–ª–∏—á–Ω—ã–µ</label>
                
                <input type="radio" name="paymentType" id="p-kaspi" class="radio-input" value="Kaspi" onchange="togglePayment()">
                <label for="p-kaspi" class="radio-label">üî¥ Kaspi</label>

                <input type="radio" name="paymentType" id="p-halyk" class="radio-input" value="Halyk" onchange="togglePayment()">
                <label for="p-halyk" class="radio-label">üü¢ Halyk</label>
            </div>
        </div>

        <div id="payment-phone-block" style="display: none;">
            <div class="option-group">
                <label class="option-label">–ù–æ–º–µ—Ä –¥–ª—è –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç–∞</label>
                <input type="tel" id="payment-phone" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –∫–∞—Ä—Ç–µ">
            </div>
        </div>

        <div class="checkout-total" id="checkout-total-sum">–ò—Ç–æ–≥–æ: 0 ‚Ç∏</div>
        
        <button class="modal-add-btn" onclick="submitOrder()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–∫–∞–∑</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand(); 

    // --- –¶–ï–ù–´ –ò –ö–û–ù–°–¢–ê–ù–¢–´ ---
    const DELIVERY_COST = 600;
    
    const PRICES = {
        milk_lactose_free: 0, 
        milk_alternative: 400,
        extra_shot: 300,
        syrup: 0,
        coffee_add_milk: 50,
        coffee_add_cream: 50,
        tea_add_milk: 50,
        tea_add_cream: 50,
        tea_add_honey: 100
    };

    const SYRUPS = [
        "–ù–µ—Ç", "–ö–∞—Ä–∞–º–µ–ª—å", "–°–æ–ª–µ–Ω–∞—è –∫–∞—Ä–∞–º–µ–ª—å", "–ö–æ–∫–æ—Å", "–õ–µ—Å–Ω–æ–π –æ—Ä–µ—Ö", "–®–æ–∫–æ–ª–∞–¥", "–í–∞–Ω–∏–ª—å", 
        "–ò—Ä–∏—Å", "–ü–æ–ø–∫–æ—Ä–Ω", "–ú–∞–∫–∞–¥–∞–º–∏—è", "–ö—Ä–µ–º –±—Ä—é–ª–µ", "–®–æ–∫–æ–ª–∞–¥–Ω–æ–µ –ø–µ—á–µ–Ω—å–µ", "–õ–µ–º–æ–Ω–≥—Ä–∞—Å—Å", 
        "–§–∏—Å—Ç–∞—à–∫–∞", "–ë–∞–Ω–∞–Ω", "–ê–º–∞—Ä–µ—Ç—Ç–æ", "–ú–∏–Ω–¥–∞–ª—å", "–ú–µ–¥", "–ì—Ä–∞–Ω–∞—Ç", "–ò—Ä–ª–∞–Ω–¥—Å–∫–∏–π –∫—Ä–µ–º", 
        "–õ–∞–≤–∞–Ω–¥–∞", "–ë—Ä–∞—É–Ω–∏", "–ö–ª—É–±–Ω–∏–∫–∞"
    ];

    // --- –ë–ê–ó–ê –î–ê–ù–ù–´–• ---
    const menuData = [
        {
            id: "espresso", type: "complex", cat: "–ö–æ—Ñ–µ", name: "–≠—Å–ø—Ä–µ—Å—Å–æ", desc: "–ù–∞—Å—ã—â–µ–Ω–Ω—ã–π –∏ –∫—Ä–µ–ø–∫–∏–π",
            hasMilk: false, allowCoffeeExtras: true, hasVolumes: false, basePrice: 700, volumes: []
        },
        {
            id: "americano", type: "complex", cat: "–ö–æ—Ñ–µ", name: "–ê–º–µ—Ä–∏–∫–∞–Ω–æ", desc: "–ú—è–≥–∫–∏–π —á–µ—Ä–Ω—ã–π –∫–æ—Ñ–µ",
            hasMilk: false, allowCoffeeExtras: true, hasVolumes: true, 
            volumes: [{n: "0.2 –ª", p: 700}, {n: "0.3 –ª", p: 850}]
        },
        {
            id: "flatwhite", type: "complex", cat: "–ö–æ—Ñ–µ", name: "–§–ª—ç—Ç —É–∞–π—Ç", desc: "–î–≤–æ–π–Ω–æ–π —ç—Å–ø—Ä–µ—Å—Å–æ –∏ –º–æ–ª–æ–∫–æ",
            hasMilk: true, hasVolumes: false, basePrice: 950, volumes: []
        },
        {
            id: "cappuccino", type: "complex", cat: "–ö–æ—Ñ–µ", name: "–ö–∞–ø—É—á–∏–Ω–æ", desc: "–ö–ª–∞—Å—Å–∏–∫–∞ —Å –ø–µ–Ω–∫–æ–π",
            hasMilk: true, hasVolumes: true,
            volumes: [{n: "0.3 –ª", p: 1000}, {n: "0.4 –ª", p: 1200}]
        },
        {
            id: "latte", type: "complex", cat: "–ö–æ—Ñ–µ", name: "–õ–∞—Ç—Ç–µ", desc: "–ú–Ω–æ–≥–æ –º–æ–ª–æ–∫–∞",
            hasMilk: true, hasVolumes: true,
            volumes: [{n: "0.3 –ª", p: 950}, {n: "0.4 –ª", p: 1100}]
        },
        {
            id: "raf", type: "complex", cat: "–ö–æ—Ñ–µ", name: "–†–∞—Ñ", desc: "–ù–∞ —Å–ª–∏–≤–∫–∞—Ö",
            hasMilk: false, hasVolumes: true,
            volumes: [{n: "0.3 –ª", p: 1400}, {n: "0.4 –ª", p: 1800}]
        },
        {
            id: "mocha", type: "complex", cat: "–ö–æ—Ñ–µ", name: "–ú–æ–∫–∫–æ", desc: "–° —à–æ–∫–æ–ª–∞–¥–æ–º",
            hasMilk: true, hasVolumes: true,
            volumes: [{n: "0.3 –ª", p: 1000}, {n: "0.4 –ª", p: 1300}]
        },
        {
            id: "hotchoc", type: "complex", cat: "–ö–æ—Ñ–µ", name: "–ì–æ—Ä—è—á–∏–π —à–æ–∫–æ–ª–∞–¥", desc: "–ì—É—Å—Ç–æ–π –∏ —Å–ª–∞–¥–∫–∏–π",
            hasMilk: true, hasVolumes: true,
            volumes: [{n: "0.3 –ª", p: 850}, {n: "0.4 –ª", p: 1200}]
        },

        // –ß–ê–ô
        {
            id: "black_tea", type: "complex", cat: "–ß–∞–π", name: "–ß–µ—Ä–Ω—ã–π —á–∞–π", desc: "",
            hasVolumes: false, fixedVolume: "300 –º–ª", basePrice: 250, allowTeaExtras: true
        },
        {
            id: "green_tea", type: "complex", cat: "–ß–∞–π", name: "–ó–µ–ª–µ–Ω—ã–π —á–∞–π", desc: "",
            hasVolumes: false, fixedVolume: "300 –º–ª", basePrice: 250, allowTeaExtras: true
        },
        {
            id: "tashkent", type: "complex", cat: "–ß–∞–π", name: "–¢–∞—à–∫–µ–Ω—Ç—Å–∫–∏–π", desc: "–° –ø—Ä—è–Ω—ã–º–∏ –Ω–æ—Ç–∫–∞–º–∏",
            hasVolumes: true, allowTeaExtras: true,
            volumes: [{n: "–°—Ç–∞–∫–∞–Ω 400 –º–ª", p: 700}, {n: "–ß–∞–π–Ω–∏–∫ 1 –ª", p: 1200}]
        },
        {
            id: "oblepiha", type: "complex", cat: "–ß–∞–π", name: "–û–±–ª–µ–ø–∏—Ö–æ–≤—ã–π", desc: "–í–∏—Ç–∞–º–∏–Ω–Ω—ã–π",
            hasVolumes: true, allowTeaExtras: true,
            volumes: [{n: "–°—Ç–∞–∫–∞–Ω 400 –º–ª", p: 800}, {n: "–ß–∞–π–Ω–∏–∫ 1 –ª", p: 1300}]
        },
        {
            id: "citrus_tea", type: "complex", cat: "–ß–∞–π", name: "–¶–∏—Ç—Ä—É—Å–æ–≤—ã–π —á–∞–π", desc: "–°–µ–∑–æ–Ω–Ω–æ–µ",
            hasVolumes: true, allowTeaExtras: true,
            volumes: [{n: "–°—Ç–∞–∫–∞–Ω 400 –º–ª", p: 1000}, {n: "–ß–∞–π–Ω–∏–∫ 1 –ª", p: 1600}] 
        },
        {
            id: "masala", type: "complex", cat: "–ß–∞–π", name: "–ß–∞–π –ú–∞—Å–∞–ª–∞", desc: "–ü—Ä—è–Ω—ã–π",
            hasVolumes: true, allowTeaExtras: true,
            volumes: [{n: "–°—Ç–∞–∫–∞–Ω 400 –º–ª", p: 1850}, {n: "–ß–∞–π–Ω–∏–∫ 1 –ª", p: 2800}] 
        },
        {
            id: "mango_chili", type: "complex", cat: "–ß–∞–π", name: "–ß–∞–π –ú–∞–Ω–≥–æ-–ß–∏–ª–∏", desc: "–û—Å—Ç—Ä—ã–π",
            hasVolumes: true, allowTeaExtras: true,
            volumes: [{n: "–°—Ç–∞–∫–∞–Ω 400 –º–ª", p: 1350}, {n: "–ß–∞–π–Ω–∏–∫ 1 –ª", p: 2000}]
        },
