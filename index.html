<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Кофейня Меню</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- СТИЛИ (КРАСОТА) --- */
        body { font-family: sans-serif; margin: 0; padding: 0; background-color: #f5f5f5; color: #333; padding-bottom: 80px; }
        header { background-color: #3e2723; color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; }
        h1 { margin: 0; font-size: 18px; }
        
        .category-title { padding: 15px; font-size: 20px; font-weight: bold; color: #5d4037; border-bottom: 2px solid #ddd; margin-top: 10px; }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .card { background: white; border-radius: 12px; padding: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; display: flex; flex-direction: column; justify-content: space-between; }
        .card img { width: 100%; height: 100px; object-fit: cover; border-radius: 8px; margin-bottom: 8px; background: #eee; }
        .card h3 { margin: 5px 0; font-size: 14px; }
        .card .price { font-weight: bold; color: #3e2723; margin-bottom: 8px; }
        .btn { background-color: #ffb300; border: none; padding: 8px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        /* Всплывающее окно (Модалка) */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; padding: 20px; border-radius: 15px; width: 85%; max-width: 350px; }
        .option-group { margin-bottom: 15px; }
        .option-group label { display: block; font-weight: bold; margin-bottom: 5px; }
        .option-group select { width: 100%; padding: 8px; border-radius: 5px; border: 1px solid #ccc; }
        
        /* Кнопка Корзины */
        .main-btn { position: fixed; bottom: 10px; left: 10px; right: 10px; background: #4caf50; color: white; padding: 15px; border-radius: 10px; text-align: center; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.2); display: none; }
    </style>
</head>
<body>

<header>
    <h1 id="header-title">CoffeeMoll</h1>
</header>

<div id="app">
    </div>

<div class="main-btn" id="order-btn" onclick="sendOrder()">
    Оформить заказ
</div>

<div class="modal" id="product-modal">
    <div class="modal-content">
        <h2 id="modal-title">Название</h2>
        <p id="modal-base-price" style="display:none">0</p>
        
        <div id="modal-options"></div>
        
        <div style="display: flex; justify-content: space-between; margin-top: 20px;">
            <button onclick="closeModal()" style="background: #ccc; border:none; padding: 10px; border-radius: 5px;">Отмена</button>
            <button onclick="addToCartConfirm()" class="btn" style="background: #4caf50; color: white; width: auto; padding: 0 20px;">Добавить</button>
        </div>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand(); // Раскрыть на весь экран

    // --- 1. БАЗА ДАННЫХ (РЕДАКТИРУЙТЕ ЗДЕСЬ) ---
    // format: { id, name, price, category, image, hasOptions (true для кофе) }
    const products = [
        // Категория КОФЕ (С опциями)
        { id: 1, name: "Латте", price: 900, category: "Кофе", image: "https://cdn-icons-png.flaticon.com/512/2935/2935413.png", hasOptions: true },
        { id: 2, name: "Капучино", price: 900, category: "Кофе", image: "https://cdn-icons-png.flaticon.com/512/924/924514.png", hasOptions: true },
        { id: 3, name: "Американо", price: 700, category: "Кофе", image: "https://cdn-icons-png.flaticon.com/512/3054/3054889.png", hasOptions: true },
        
        // Категория ЕДА (Без опций)
        { id: 4, name: "Круассан", price: 650, category: "Выпечка", image: "https://cdn-icons-png.flaticon.com/512/3014/3014528.png", hasOptions: false },
        { id: 5, name: "Пицца Пеперони", price: 2200, category: "Еда", image: "https://cdn-icons-png.flaticon.com/512/3132/3132693.png", hasOptions: false },
        { id: 6, name: "Салат Цезарь", price: 1800, category: "Еда", image: "https://cdn-icons-png.flaticon.com/512/2062/2062296.png", hasOptions: false }
    ];

    // Опции для кофе
    const modifiers = {
        size: { name: "Объем", variants: [{n: "0.3 л", p: 0}, {n: "0.4 л", p: 300}] },
        milk: { name: "Молоко", variants: [{n: "Обычное", p: 0}, {n: "Кокосовое", p: 400}, {n: "Миндальное", p: 400}] },
        syrup: { name: "Сироп", variants: [{n: "Нет", p: 0}, {n: "Карамель", p: 150}, {n: "Ваниль", p: 150}] }
    };

    let cart = [];
    let currentProduct = null;

    // --- 2. ОТРИСОВКА МЕНЮ ---
    function renderMenu() {
        const app = document.getElementById('app');
        const categories = [...new Set(products.map(p => p.category))]; // Получаем уникальные категории
        
        categories.forEach(cat => {
            const title = document.createElement('div');
            title.className = 'category-title';
            title.innerText = cat;
            app.appendChild(title);

            const grid = document.createElement('div');
            grid.className = 'grid';
            
            products.filter(p => p.category === cat).forEach(p => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <img src="${p.image}" alt="${p.name}">
                    <h3>${p.name}</h3>
                    <div class="price">${p.price} ₸</div>
                    <button class="btn" onclick="openProduct(${p.id})">Выбрать</button>
                `;
                grid.appendChild(card);
            });
            app.appendChild(grid);
        });
    }

    // --- 3. ЛОГИКА МОДАЛЬНОГО ОКНА ---
    function openProduct(id) {
        currentProduct = products.find(p => p.id === id);
        
        if (!currentProduct.hasOptions) {
            // Если это просто круассан, сразу в корзину
            addToCart(currentProduct, [], currentProduct.price);
            return;
        }

        // Если это кофе, открываем модалку
        document.getElementById('modal-title').innerText = currentProduct.name;
        document.getElementById('modal-base-price').innerText = currentProduct.price;
        
        const optionsDiv = document.getElementById('modal-options');
        optionsDiv.innerHTML = '';

        // Генерируем выпадающие списки (Объем, Молоко, Сироп)
        for (const [key, data] of Object.entries(modifiers)) {
            const group = document.createElement('div');
            group.className = 'option-group';
            
            let selectHTML = `<label>${data.name}</label><select id="opt-${key}">`;
            data.variants.forEach((v, index) => {
                selectHTML += `<option value="${index}" data-price="${v.p}">${v.n} ${v.p > 0 ? '(+' + v.p + ')' : ''}</option>`;
            });
            selectHTML += `</select>`;
            
            group.innerHTML = selectHTML;
            optionsDiv.appendChild(group);
        }

        document.getElementById('product-modal').style.display = 'flex';
    }

    function closeModal() {
        document.getElementById('product-modal').style.display = 'none';
    }

    function addToCartConfirm() {
        // Собираем выбранные опции
        let finalPrice = currentProduct.price;
        let selectedOptions = [];

        for (const key of Object.keys(modifiers)) {
            const select = document.getElementById(`opt-${key}`);
            const optionIndex = select.value;
            const variant = modifiers[key].variants[optionIndex];
            
            finalPrice += variant.p;
            selectedOptions.push(`${modifiers[key].name}: ${variant.n}`);
        }

        addToCart(currentProduct, selectedOptions, finalPrice);
        closeModal();
    }

    // --- 4. КОРЗИНА ---
    function addToCart(product, options, finalPrice) {
        cart.push({
            name: product.name,
            options: options,
            price: finalPrice
        });
        updateMainButton();
        tg.HapticFeedback.notificationOccurred('success'); // Вибрация
    }

    function updateMainButton() {
        const btn = document.getElementById('order-btn');
        if (cart.length > 0) {
            const total = cart.reduce((sum, item) => sum + item.price, 0);
            btn.style.display = 'block';
            btn.innerText = `Оформить заказ: ${total} ₸`;
        } else {
            btn.style.display = 'none';
        }
    }

    // --- 5. ОТПРАВКА ЗАКАЗА БОТУ ---
    function sendOrder() {
        const total = cart.reduce((sum, item) => sum + item.price, 0);
        const data = {
            cart: cart,
            total: total
        };
        tg.sendData(JSON.stringify(data)); // Отправляем данные в Telegram
    }

    // Запуск
    renderMenu();
</script>
</body>

</html>
