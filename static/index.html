<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CoffeeMoll</title>

    <!-- –ó–ê–ü–†–ï–¢ –ö–ï–®–ò–†–û–í–ê–ù–ò–Ø -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <link rel="preload" href="https://telegram.org/js/telegram-web-app.js" as="script">
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Oswald:wght@500;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞—à–∏ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="static/styles.css">

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>window.onerror = function(msg, url, line) { return false; };</script>
</head>
<body>

<!-- –≠–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏ -->
<div class="loading-overlay" id="loading-screen">
    <div class="spinner"></div>
    <div class="loading-title"><span class="logo-coffee">COFFEE</span><span class="logo-moll">MOLL</span></div>
    <div class="separator-line"></div>
    <div class="loading-motto">–ó–∞–≥—Ä—É–∂–∞–µ–º –º–µ–Ω—é...</div>
</div>

<div id="toast-container"></div>

<!-- –≠–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏ -->
<div class="loading-overlay" id="error-screen" style="display: none;">
    <div style="font-size: 50px; margin-bottom: 10px;">üì°</div>
    <div class="loading-title" style="font-size: 24px;">–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏</div>
    <button class="modal-add-btn" style="width: auto; padding: 10px 30px; margin-top: 20px;" onclick="location.reload()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
</div>

<!-- –•–µ–¥–µ—Ä -->
<div class="header-container" id="header-container">
    <header id="main-header">
        <div class="header-left">
            <h1><span class="logo-coffee">COFFEE</span><span class="logo-moll">MOLL</span></h1>
            <div class="separator-line"></div>
            <div class="motto">–ö–æ—Ñ–µ–π–Ω—è —Å –Ω–µ–ø—Ä–∏–ª–∏—á–Ω–æ –≤–∫—É—Å–Ω—ã–º –∫–æ—Ñ–µ</div>
        </div>
        <div style="display:flex; align-items:center;">
            <div id="work-status" class="status-badge">Checking...</div>
        </div>
    </header>

    <div id="collapsible-header">
        <div class="collapsible-inner">
            <!-- Yandex Widget -->
            <div class="yandex-widget-container">
                <div class="yandex-widget-header" onclick="toggleYandexWidget(this)">
                    <span>üìç –ú—ã –µ—Å—Ç—å –Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç–∞—Ö</span>
                    <span class="yandex-widget-arrow">‚ñº</span>
                </div>
                <div class="yandex-widget-content" id="yandex-content">
                    <div class="iframe-wrapper">
                        <div class="yandex-light">
                            <iframe src="https://yandex.kz/sprav/widget/rating-badge/125095434429?type=rating" frameborder="0"></iframe>
                        </div>
                        <div class="yandex-dark">
                            <iframe src="https://yandex.kz/sprav/widget/rating-badge/125095434429?type=rating&theme=dark" frameborder="0"></iframe>
                        </div>
                    </div>
                </div>
            </div>

            <div class="search-wrapper">
                <input type="text" id="search-input" placeholder="üîç –ù–∞–π—Ç–∏ –Ω–∞–ø–∏—Ç–æ–∫ –∏–ª–∏ –µ–¥—É..." oninput="filterMenu()">
            </div>

            <div id="repeat-order-container">
                <div class="repeat-card" onclick="loadLastOrder()">
                    <div class="repeat-info">
                        <div class="repeat-title">‚Üª –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø—Ä–æ—à–ª—ã–π –∑–∞–∫–∞–∑</div>
                        <div class="repeat-desc" id="repeat-desc">...</div>
                        <div id="repeat-price" style="font-weight:bold; font-size:13px; color: var(--text-main); margin-top: 4px;"></div>
                    </div>
                    <div style="font-weight:bold; color:var(--primary-color); font-size: 20px;">‚ûî</div>
                </div>
            </div>
        </div>
    </div>
    <div class="nav-scroller" id="nav-container"></div>
</div>

<!-- App Content -->
<div id="app"></div>

<div id="no-results" style="display:none; text-align:center; padding: 50px 20px; color: var(--text-secondary);">
    <div style="font-size: 40px; margin-bottom: 10px;">üîç</div>
    <h3>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
</div>

<!-- Floating Button -->
<div class="main-btn" id="cart-btn" onclick="openCheckout()">
    <span id="cart-text">–ö –∫–æ—Ä–∑–∏–Ω–µ</span>
    <div class="cart-counter" id="cart-count" style="background: white; color: black; border-radius: 50%; width: 22px; height: 22px; position: absolute; top: -8px; right: -8px; display: flex; align-items: center; justify-content: center; font-size: 12px;">0</div>
</div>

<!-- Product Modal -->
<div class="modal-overlay" id="product-modal" onclick="closeProductModal(event)">
    <div class="modal-content" id="product-modal-content"></div>
</div>

<!-- Checkout Modal -->
<div class="modal-overlay" id="checkout-modal">
    <div class="modal-content" id="checkout-content">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div class="modal-title">–ö–û–†–ó–ò–ù–ê</div>
            <button class="clear-cart-btn" onclick="clearCart()">–û—á–∏—Å—Ç–∏—Ç—å</button>
            <div class="close-icon" style="position: relative; top: 0; right: 0;" onclick="closeCheckout()">‚úï</div>
        </div>

        <div id="closed-warning" class="warning-box" style="display:none;">üåô <b>–ú—ã —Å–µ–π—á–∞—Å –∑–∞–∫—Ä—ã—Ç—ã.</b><br>–ü—Ä–∏–≥–æ—Ç–æ–≤–∏–º –≤–∞—à –∑–∞–∫–∞–∑ –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è (—Å 09:00).</div>
        <div id="closing-soon-warning" class="warning-box" style="display:none; background:#fef3c7; color:#b45309; border-color:#fcd34d;">‚ö†Ô∏è <b>–°–∫–æ—Ä–æ –∑–∞–∫—Ä—ã—Ç–∏–µ!</b><br>–£—Å–ø–µ–π—Ç–µ —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑ –¥–æ –∫–æ–Ω—Ü–∞ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è (23:00).</div>
        <div id="pizza-warning" class="info-box">üçï <b>–ü–∏—Ü—Ü–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ —Å 11:00.</b><br>–ù–∞—á–Ω–µ–º –≥–æ—Ç–æ–≤–∏—Ç—å –µ—ë –ø–æ—Å–ª–µ 11:00.</div>

        <div id="cart-list-container"></div>

        <!-- Promo Code -->
        <div class="promo-section" id="promo-container" style="display:flex; gap:10px; margin: 15px 0;">
            <input type="text" id="promo-code" placeholder="–ü—Ä–æ–º–æ–∫–æ–¥" style="margin-bottom: 0; flex:1;">
            <button class="promo-btn" id="apply-promo-btn" onclick="applyPromo()" style="background: #f0f0f0; border:none; border-radius:12px; font-weight:bold; padding:0 20px; cursor:pointer;">–û–ö</button>
        </div>

        <div class="checkout-total" id="checkout-total-sum" style="text-align: right; font-size: 18px; font-weight: 800; margin: 20px 0;">–ò—Ç–æ–≥–æ: 0 ‚Ç∏</div>
        <hr style="border: 0; height: 1px; background: var(--border-color); margin: 20px 0;">
        <h3 style="font-family: var(--font-title); margin-bottom: 15px;">–î–ï–¢–ê–õ–ò –ó–ê–ö–ê–ó–ê</h3>

        <div class="option-group">
            <input type="text" id="client-name" placeholder="–í–∞—à–µ –∏–º—è" oninput="validateForm()">
            <input type="tel" id="client-phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" oninput="maskPhone(event); validateForm();">
        </div>

        <div class="option-group">
            <label class="option-label">–í—Ä–µ–º—è</label>
            <div class="checkout-radio-group">
                <input type="radio" name="orderTimeType" id="t-asap" value="asap" class="checkout-radio-input" checked onchange="toggleTimePicker()">
                <label for="t-asap" class="checkout-radio-label">‚ö° –ö–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ</label>
                <input type="radio" name="orderTimeType" id="t-time" value="time" class="checkout-radio-input" onchange="toggleTimePicker()">
                <label for="t-time" class="checkout-radio-label">‚è∞ –ö–æ –≤—Ä–µ–º–µ–Ω–∏</label>
            </div>
            <div id="time-picker-container" style="display: none; margin-top: 10px;">
                <input type="time" id="specific-time">
            </div>
        </div>

        <div class="option-group">
            <label class="option-label">–ü–æ–ª—É—á–µ–Ω–∏–µ</label>
            <div class="checkout-radio-group">
                <input type="radio" name="deliveryType" id="d-pickup" value="pickup" class="checkout-radio-input" checked onchange="toggleDelivery()">
                <label for="d-pickup" class="checkout-radio-label">üö∂ –°–∞–º–æ–≤—ã–≤–æ–∑</label>
                <input type="radio" name="deliveryType" id="d-dinein" value="dinein" class="checkout-radio-input" onchange="toggleDelivery()">
                <label for="d-dinein" class="checkout-radio-label">üçΩÔ∏è –í –∑–∞–ª–µ</label>
                <input type="radio" name="deliveryType" id="d-delivery" value="delivery" class="checkout-radio-input" onchange="toggleDelivery()">
                <label for="d-delivery" class="checkout-radio-label">üöó –î–æ—Å—Ç–∞–≤–∫–∞</label>
            </div>
            <div id="delivery-msg" class="delivery-warning" style="display:none; font-size:12px; color:#d97706; margin-top:5px;">‚ö†Ô∏è –î–æ—Å—Ç–∞–≤–∫–∞ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –∫—É—Ä—å–µ—Ä—É (–æ—Ç 600‚Ç∏, –¥–æ –¥–≤–µ—Ä–∏ –æ—Ç 800‚Ç∏).</div>
        </div>

        <div id="address-block" style="display: none;">
            <textarea id="delivery-address" placeholder="–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏..." style="height: 60px;" oninput="validateForm()"></textarea>
        </div>

        <div class="option-group">
            <label class="option-label">–û–ø–ª–∞—Ç–∞</label>
            <div class="checkout-radio-group">
                <input type="radio" name="paymentType" id="p-kaspi" value="Kaspi" class="checkout-radio-input" checked onchange="togglePayment()">
                <label for="p-kaspi" class="checkout-radio-label">üî¥ Kaspi</label>
                <input type="radio" name="paymentType" id="p-halyk" value="Halyk" class="checkout-radio-input" onchange="togglePayment()">
                <label for="p-halyk" class="checkout-radio-label">üü¢ Halyk</label>
            </div>
            <div id="payment-phone-block" style="margin-top: 10px;">
                <label class="option-label" id="payment-phone-label" style="font-size: 13px; margin-bottom: 5px;">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ Kaspi</label>
                <input type="tel" id="payment-phone" placeholder="–ù–æ–º–µ—Ä –ø—Ä–∏–≤—è–∑–∞–Ω–Ω—ã–π –∫ –∫–∞—Ä—Ç–µ" oninput="maskPhone(event); validateForm();">
                <div style="font-size:11px; color:var(--text-secondary); margin-top:5px;" id="payment-hint">–í–∞–º –ø—Ä–∏–¥–µ—Ç —Å—á–µ—Ç –Ω–∞ –æ–ø–ª–∞—Ç—É –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Kaspi.kz</div>
            </div>
        </div>

        <div class="option-group">
            <textarea id="order-comment" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É..."></textarea>
        </div>

        <button class="modal-add-btn" id="submit-btn" onclick="submitOrder()">–û–¢–ü–†–ê–í–ò–¢–¨ –ó–ê–ö–ê–ó</button>
    </div>
</div>

<!-- Upsell Modal -->
<div class="upsell-overlay" id="upsell-modal">
    <div class="upsell-content">
        <h3 class="upsell-title">–í–ö–£–°–ù–û–ï –î–û–ü–û–õ–ù–ï–ù–ò–ï!</h3>
        <img src="" alt="Upsell" class="upsell-img">
        <div class="upsell-product">–¢–û–í–ê–†</div>
        <div class="upsell-desc" id="upsell-price">0 ‚Ç∏</div>
        <div class="upsell-btn-row">
            <button class="upsell-no" onclick="closeUpsell()">–ù–µ—Ç</button>
            <button class="upsell-yes" onclick="acceptUpsell()">–î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
    </div>
</div>

<!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –Ω–∞—à —Å–∫—Ä–∏–ø—Ç (Logic) -->
<script src="static/logic.js"></script>

</body>
</html>
