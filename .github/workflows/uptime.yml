name: ‚òï Coffee Shop Monitor

on:
  # 1. –ó–∞–ø—É—Å–∫ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
  schedule:
    # –ó–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
    # –° 04:00 –¥–æ 18:00 –ø–æ UTC (–≠—Ç–æ 09:00 - 23:00 –ø–æ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω—É)
    - cron: '*/15 3-19 * * *'
  
  # 2. –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é –∫–Ω–æ–ø–∫—É (–¥–ª—è —Ç–µ—Å—Ç–∞)
  workflow_dispatch:

jobs:
  check-website:
    runs-on: ubuntu-latest
    steps:
      - name: Check website availability
        env:
          URL: ${{ secrets.SITE_URL }}
          TOKEN: ${{ secrets.TELEGRAM_TOKE }}
          CHAT_ID: ${{ secrets.TELEGRAM_TO }}
        run: |
          # –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ —Å–∞–π—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 200)
          http_code=$(curl -o /dev/null -s -w "%{http_code}\n" "$URL")
          
          echo "Checking URL: $URL"
          echo "Response Code: $http_code"
          
          # –ï—Å–ª–∏ –∫–æ–¥ –ù–ï —Ä–∞–≤–µ–Ω 200 (–û–ö), –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç—Ä–µ–≤–æ–≥—É
          if [ "$http_code" -ne 200 ]; then
            echo "üö® –ë–û–¢ –£–ü–ê–õ!"
            
            # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            MESSAGE="‚ö†Ô∏è <b>–í–Ω–∏–º–∞–Ω–∏–µ!</b>%0A–°–∞–π—Ç –º–µ–Ω—é –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω!%0A–ö–æ–¥ –æ—à–∏–±–∫–∏: $http_code%0A–í—Ä–µ–º—è: $(date)"
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram
            curl -s -X POST "https://api.telegram.org/bot$TOKEN/sendMessage" \
              -d chat_id="$CHAT_ID" \
              -d text="$MESSAGE" \
              -d parse_mode="HTML"
              
            # –ó–∞–≤–µ—Ä—à–∞–µ–º —Å –æ—à–∏–±–∫–æ–π, —á—Ç–æ–±—ã –≤ GitHub –∑–∞–≥–æ—Ä–µ–ª—Å—è –∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫
            exit 1
          else
            echo "‚úÖ –°–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –æ—Ç–ª–∏—á–Ω–æ."
          fi
