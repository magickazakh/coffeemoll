name: ‚òï Keep-Alive & Monitor

on:
  schedule:
    # CRON: –ö–∞–∂–¥—ã–µ 14 –º–∏–Ω—É—Ç
    # –ß–∞—Å—ã (UTC): —Å 03:00 –¥–æ 18:59
    # –ß–∞—Å—ã (KZ):  —Å 08:00 –¥–æ 23:59 (–° –∑–∞–ø–∞—Å–æ–º –ø–æ–∫—Ä—ã–≤–∞–µ—Ç 08:30 - 23:30)
    - cron: '*/9 3-18 * * *'
  
  # –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å)
  workflow_dispatch:

jobs:
  ping-render:
    runs-on: ubuntu-latest
    steps:
      - name: Wake up Render
        env:
          URL: ${{ secrets.SITE_URL }}
          TOKEN: ${{ secrets.TELEGRAM_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_TO }}
        run: |
          echo "Pinging $URL to keep it alive..."
          
          # --max-time 60: –ñ–¥–µ–º –æ—Ç–≤–µ—Ç 60 —Å–µ–∫—É–Ω–¥ (Render –º–æ–∂–µ—Ç –¥–æ–ª–≥–æ –ø—Ä–æ—Å—ã–ø–∞—Ç—å—Å—è)
          # --retry 3: –ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –ø—Ä–æ–±—É–µ–º –µ—â–µ 3 —Ä–∞–∑–∞
          http_code=$(curl -o /dev/null -s -w "%{http_code}\n" --max-time 60 --retry 3 "$URL")
          
          echo "Response Code: $http_code"
          
          # –ï—Å–ª–∏ –∫–æ–¥ –ù–ï 200, –∑–Ω–∞—á–∏—Ç —Å–∞–π—Ç –ª–µ–∂–∏—Ç
          if [ "$http_code" -ne 200 ]; then
            echo "üö® –ë–æ—Ç –Ω–µ –ø—Ä–æ—Å–Ω—É–ª—Å—è!"
            
            MESSAGE="‚ö†Ô∏è <b>Render –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç!</b>%0A–ö–æ–¥: $http_code%0A–í—Ä–µ–º—è: $(date)"
            
            # –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
            curl -s -X POST "https://api.telegram.org/bot$TOKEN/sendMessage" \
              -d chat_id="$CHAT_ID" \
              -d text="$MESSAGE" \
              -d parse_mode="HTML"
              
            exit 1
          else
            echo "‚úÖ Render –∞–∫—Ç–∏–≤–µ–Ω (—É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Å–Ω—É–ª—Å—è)."
          fi
